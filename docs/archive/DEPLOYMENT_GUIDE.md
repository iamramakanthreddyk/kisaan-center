# KisaanCenter Deployment Setup Guide

## Overview
This guide will help you deploy the KisaanCenter application with:
- **Frontend**: GitHub Pages (Free)
- **Backend**: Azure Container Apps (Free Tier)
- **Database**: Azure PostgreSQL Flexible Server (Free Tier)

## Prerequisites

### 1. GitHub Repository Setup
- Ensure your repository is public (required for GitHub Pages)
- Enable GitHub Actions in your repository settings

### 2. GitHub Pages Configuration
1. Go to your repository Settings → Pages
2. Source: Deploy from a branch
3. Branch: `gh-pages` (will be created automatically by workflow)
4. Click Save

### 3. Azure Setup
You'll need an Azure subscription and service principal for deployment.

#### Create Azure Service Principal
```bash
az login
az account set --subscription "Your-Subscription-ID"

# Create service principal
az ad sp create-for-rbac --name "kisaancenter-deployer" \
  --role "Contributor" \
  --scopes "/subscriptions/YOUR-SUBSCRIPTION-ID" \
  --sdk-auth
```

This will output JSON credentials that you'll use in GitHub Secrets.

### 4. GitHub Secrets Configuration
Add these secrets to your repository (Settings → Secrets and variables → Actions):

#### Azure Deployment Secrets
- `AZURE_CLIENT_ID`: From service principal output
- `AZURE_CLIENT_SECRET`: From service principal output  
- `AZURE_SUBSCRIPTION_ID`: Your Azure subscription ID
- `AZURE_TENANT_ID`: From service principal output
- `AZURE_CONTAINER_APP_NAME`: Name of your container app (e.g., "kisaancenter-backend")
- `AZURE_RESOURCE_GROUP`: Name of your resource group (e.g., "kisaancenter-rg")

#### Frontend Configuration Secret
- `VITE_API_BASE_URL`: Your backend API URL (will be generated by Terraform)

## Deployment Steps

### Step 1: Deploy Infrastructure with Terraform
```bash
cd terraform
terraform init
terraform plan
terraform apply
```

After successful deployment, note the `backend_container_app_url` output. This is your API URL.

### Step 2: Update GitHub Secrets
Add the backend URL from Terraform output to your GitHub secret:
- `VITE_API_BASE_URL`: The `backend_container_app_url` from Terraform (e.g., "https://kisaancenter-backend.xxx.azurecontainerapps.io")

### Step 3: Trigger Deployments
Push changes to the `main` branch to automatically trigger deployments:

```bash
git add .
git commit -m "Initial deployment setup"
git push origin main
```

This will automatically:
1. Build and deploy the frontend to GitHub Pages
2. Build and deploy the backend to Azure Container Apps

## Manual Deployment (if needed)
You can also trigger deployments manually:
1. Go to Actions tab in your GitHub repository
2. Select "Deploy Frontend to GitHub Pages" or "Deploy Backend to Azure Container Apps"
3. Click "Run workflow"

## Accessing Your Application

### Frontend
- **GitHub Pages URL**: `https://YOUR-USERNAME.github.io/kisaanCenter/`
- **Custom Domain** (if configured): `https://kisaancenter.com`

### Backend API
- **Azure Container Apps URL**: From Terraform output
- **Health Check**: `https://YOUR-BACKEND-URL/health`

## Cost Estimation

### Free Tier Usage (12 months)
- **GitHub Pages**: Free
- **Azure Container Apps**: Free (180,000 vCPU-seconds/month)
- **PostgreSQL Flexible Server**: Free (B1ms + 32GB storage)
- **Other Azure services**: ~€0.60/month

### After Free Tier (monthly costs)
- **GitHub Pages**: Free
- **Azure Container Apps**: ~€5-10/month
- **PostgreSQL Flexible Server**: ~€10-15/month
- **Other Azure services**: ~€1/month

## Troubleshooting

### Frontend Issues
1. Check GitHub Actions for build errors
2. Verify `VITE_API_BASE_URL` secret is set correctly
3. Ensure repository is public for GitHub Pages

### Backend Issues
1. Check Azure Container Apps logs in Azure Portal
2. Verify all Azure secrets are set correctly
3. Check database connectivity from container app

### Database Connection Issues
1. Verify PostgreSQL is running in Azure Portal
2. Check network connectivity (VNet integration)
3. Verify environment variables in container app

## Environment Variables Reference

### Frontend (.env.production)
```
VITE_API_BASE_URL=https://your-backend-url
VITE_APP_TITLE=KisaanCenter
VITE_ENVIRONMENT=production
```

### Backend (Container App Environment)
```
DB_HOST=your-postgres-host
DB_PORT=5432
DB_NAME=kisaancenter
DB_USER=postgres
DB_PASSWORD=from-keyvault
DB_DIALECT=postgres
DB_SSL_MODE=require
SECRET_KEY=from-keyvault
NODE_ENV=production
PORT=3000
```

## Next Steps
1. Set up custom domain for frontend (optional)
2. Configure SSL certificates
3. Set up monitoring and alerts
4. Implement backup strategies
5. Configure CI/CD for staging environment

## Support
For issues with this deployment setup, check:
1. GitHub Actions logs
2. Azure Container Apps logs
3. Terraform state and outputs
4. Azure Portal resource health